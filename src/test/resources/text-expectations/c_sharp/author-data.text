using System;
using System.Linq;
using System.Collections.Generic;
using Io.Vlingo.Xoomapp;
using Io.Vlingo.Xoomapp.Model.Author;

namespace Io.Vlingo.Xoomapp.Infrastructure;

public class AuthorData : IEquatable<AuthorData>
{
  public string Id {get; set;}
  public NameData Name {get; set;}
  public RankData Rank {get; set;}
  public bool Status {get; set;}
  public List<int> BookIds {get; set;} = new List<int>();
  public DateTime UpdatedOn {get; set;}

  public AuthorData()
  {}

  public static AuthorData From(AuthorState authorState)
  {
    var name = authorState.Name != null ? NameData.From(authorState.Name) : null;
    var rank = authorState.Rank != null ? RankData.From(authorState.Rank) : null;
    var bookIds = authorState.BookIds != null ? authorState.BookIds : new List<int>();
    return From(authorState.Id, name, rank, authorState.Status, bookIds, authorState.UpdatedOn);
  }

  public static AuthorData From(string id, NameData name, RankData rank, bool status, List<int> bookIds, DateTime updatedOn)
  {
    return new AuthorData(id, name, rank, status, bookIds, updatedOn);
  }

  public static List<AuthorData> FromAll(List<AuthorState> states) => states.Select(AuthorData.From).ToList();

  public static AuthorData Empty => From(AuthorState.IdentifiedBy(""));

  private AuthorData(string id, NameData name, RankData rank, bool status, List<int> bookIds, DateTime updatedOn)
  {
    Id = id;
    Name = name;
    Rank = rank;
    Status = status;
    BookIds.AddRange(bookIds);
    UpdatedOn = updatedOn;
  }

  public AuthorState ToAuthorState()
  {
    var name = Name.From(this.Name.FirstName, this.Name.LastName);
    var classification = Classification.From(this.Rank.Classification.Label, this.Rank.Classification.Classifier);
    var rank = Rank.From(this.Rank.Points, classification);
    return new AuthorState(Id, name, rank, Status, BookIds, UpdatedOn);
  }

  public override bool Equals(object obj)
  {
    if (obj == null || obj.GetType() != GetType()) return false;

    var otherData = (AuthorData) obj;
    return Id == otherData.Id && Name == otherData.Name && Rank == otherData.Rank && Status == otherData.Status && BookIds == otherData.BookIds && UpdatedOn == otherData.UpdatedOn;
  }

  public bool Equals(AuthorData other) => Id == other.Id && Name == other.Name && Rank == other.Rank && Status == other.Status && BookIds == other.BookIds && UpdatedOn == other.UpdatedOn;
  public override int GetHashCode() => HashCode.Combine(Id, Name, Rank, Status, BookIds, UpdatedOn);

}
