using Vlingo.Xoom.Common.Serialization;
using Vlingo.Xoom.Symbio;
using Io.Vlingo.Xoomapp.Model.Author;

namespace Io.Vlingo.Xoomapp.Infrastructure.Persistence;

/**
 * See
 * <a href="https://docs.vlingo.io/xoom-lattice/entity-cqrs#stateadapter-and-stateadapterprovider">
 *   StateAdapter and StateAdapterProvider
 * </a>
 */
public class AuthorStateAdapter : StateAdapter<AuthorState, TextState>
{

  public override int TypeVersion => 1;

  public override AuthorState FromRawState(TextState raw) => (AuthorState) JsonSerialization.Deserialized(raw.Data, raw.Typed);

  public override ST FromRawState<ST>(TextState raw) => JsonSerialization.Deserialized<ST>(raw.Data);

  public override TextState ToRawState(string id, AuthorState state, int stateVersion, Metadata metadata) {
    var serialization = JsonSerialization.Serialized(state);
    return new TextState(id, typeof(AuthorState), TypeVersion, serialization, stateVersion, metadata);
  }
}
